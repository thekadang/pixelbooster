# MVP ê°œë°œ ê°€ì´ë“œ

> ì •ê¸°êµ¬ë…ê³¼ ì–´í•„ë¦¬ì—ì´íŠ¸ë¥¼ ì œì™¸í•œ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ì‹¬ì˜ MVP ë²„ì „ ê°œë°œ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-11-10
**ë²„ì „**: MVP v1.0
**ëª©í‘œ ì¶œì‹œ**: 4-6ì£¼ ë‚´

---

## ğŸ“‹ ëª©ì°¨

1. [MVP ë²”ìœ„ ì •ì˜](#mvp-ë²”ìœ„-ì •ì˜)
2. [ì œì™¸ëœ ê¸°ëŠ¥](#ì œì™¸ëœ-ê¸°ëŠ¥)
3. [êµ¬ë… ëª¨ë¸ ë³€ê²½](#êµ¬ë…-ëª¨ë¸-ë³€ê²½)
4. [êµ¬ë… ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜](#êµ¬ë…-ê²€ì¦-ë©”ì»¤ë‹ˆì¦˜)
5. [ì—…ì…€ë§ ì „ëµ](#ì—…ì…€ë§-ì „ëµ)
6. [ê´€ë¦¬ì ì„ ë¬¼ ê¸°ëŠ¥](#ê´€ë¦¬ì-ì„ ë¬¼-ê¸°ëŠ¥)
7. [ê°œë°œ ìš°ì„ ìˆœìœ„](#ê°œë°œ-ìš°ì„ ìˆœìœ„)
8. [êµ¬í˜„ ê°€ì´ë“œ](#êµ¬í˜„-ê°€ì´ë“œ)

---

## MVP ë²”ìœ„ ì •ì˜

### âœ… í¬í•¨ë˜ëŠ” í•µì‹¬ ê¸°ëŠ¥

#### 1. ì‚¬ìš©ì ì¸ì¦
- [x] ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
- [x] ì´ë©”ì¼ ì¸ì¦
- [x] JWT í† í° ê¸°ë°˜ ì¸ì¦
- [x] ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •

#### 2. ì´ë¯¸ì§€ ë³€í™˜
- [x] WebP ë³€í™˜ (Free)
- [x] AVIF ë³€í™˜ (Basic ì´ìƒ)
- [x] íŒŒì¼ ë‹¨ìœ„ ë³€í™˜ (Free)
- [x] í´ë” ë‹¨ìœ„ ë³€í™˜ (Basic ì´ìƒ)
- [x] ë°°ì¹˜ í¬ê¸° ì œí•œ (Free: 10ê°œ, Basic: 50ê°œ, Pro: 200ê°œ)

#### 3. ê¸°ê¸° ì¸ì¦
- [x] ê¸°ê¸° ID ìƒì„± ë° ë“±ë¡
- [x] ë“±ê¸‰ë³„ ê¸°ê¸° ì œí•œ (Free: 2ëŒ€, Basic: 3ëŒ€, Pro: 5ëŒ€)
- [x] ê¸°ê¸° ID ë³€ì¡° ë°©ì§€

#### 4. ë“±ê¸‰ë³„ ê¸°ëŠ¥ ì œí•œ
- [x] Free: WebPë§Œ, íŒŒì¼ ë‹¨ìœ„, ë°±ì—…/ë¡œê·¸ ì—†ìŒ
- [x] Basic: WebP + AVIF, í´ë” ë‹¨ìœ„, ë°±ì—…/ë¡œê·¸ ê°€ëŠ¥
- [x] Pro: ëª¨ë“  í¬ë§·, í´ë” ë‹¨ìœ„, ë°±ì—…/ë¡œê·¸/í†µê³„ ê°€ëŠ¥

#### 5. ë°±ì—… ë° ë¡œê·¸ (Basic ì´ìƒ)
- [x] ì›ë³¸ íŒŒì¼ ë°±ì—…
- [x] Excel ì‘ì—… ë¡œê·¸ ìƒì„±
- [x] í•˜ì´í¼ë§í¬ë¡œ íŒŒì¼ ì—°ê²°

#### 6. ë‹¤êµ­ì–´ ì§€ì›
- [x] í•œêµ­ì–´/ì˜ì–´
- [x] OS ì–¸ì–´ ìë™ ê°ì§€

#### 7. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
- [x] ì‚¬ìš©ì ëª©ë¡ ë° ê²€ìƒ‰
- [x] ë“±ê¸‰ ìˆ˜ë™ ë³€ê²½ (ê´€ë¦¬ì ì„ ë¬¼ ê¸°ëŠ¥)
- [x] í†µê³„ ëŒ€ì‹œë³´ë“œ (ì‚¬ìš©ì ìˆ˜, ë³€í™˜ íšŸìˆ˜)

---

## ì œì™¸ëœ ê¸°ëŠ¥

### âŒ Phase 2 ì´í›„ êµ¬í˜„ ì˜ˆì •

#### 1. ì •ê¸°êµ¬ë… (Stripe ì—°ë™)
**ì œì™¸ ì´ìœ **: MVPëŠ” ê´€ë¦¬ì ìˆ˜ë™ ë¶€ì—¬ ë°©ì‹ìœ¼ë¡œ ì‹œì‘

**Phase 2 êµ¬í˜„ ê³„íš**:
- Stripe Checkout ì—°ë™
- ìë™ ê²°ì œ ê°±ì‹ 
- êµ¬ë… ì·¨ì†Œ ë° í™˜ë¶ˆ
- ì²­êµ¬ì„œ ë°œí–‰

**MVP ëŒ€ì²´ ë°©ì•ˆ**:
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ë“±ê¸‰ ë¶€ì—¬
- `subscriptions` í…Œì´ë¸”ì— `granted_by` ì»¬ëŸ¼ ì¶”ê°€ (ê´€ë¦¬ì ID)
- `payment_method: 'admin_grant'` ì„¤ì •

#### 2. ì–´í•„ë¦¬ì—ì´íŠ¸ ì‹œìŠ¤í…œ
**ì œì™¸ ì´ìœ **: ì‚¬ìš©ì ê¸°ë°˜ í™•ë³´ í›„ ë„ì…

**Phase 2 êµ¬í˜„ ê³„íš**:
- ì¶”ì²œ ì½”ë“œ ìƒì„±
- ì¿ í‚¤ ì¶”ì  ë¡œì§
- ìˆ˜ìˆ˜ë£Œ ê³„ì‚° ë° ì§€ê¸‰
- ì–´í•„ë¦¬ì—ì´íŠ¸ ëŒ€ì‹œë³´ë“œ

**MVP ëŒ€ì²´ ë°©ì•ˆ**:
- DB í…Œì´ë¸”ì€ ìƒì„±í•´ë‘ë˜ ê¸°ëŠ¥ ë¹„í™œì„±í™”
- UIì— "ê³§ ì¶œì‹œ ì˜ˆì •" í‘œì‹œ

#### 3. ê³ ê¸‰ ë¶„ì„ ê¸°ëŠ¥
**ì œì™¸ ì´ìœ **: ê¸°ë³¸ í†µê³„ë¡œ ì¶©ë¶„

**Phase 2 êµ¬í˜„ ê³„íš**:
- ì‚¬ìš©ì í–‰ë™ ë¶„ì„
- ë³€í™˜ íŒ¨í„´ ë¶„ì„
- A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„

#### 4. ìë™ ì—…ë°ì´íŠ¸
**ì œì™¸ ì´ìœ **: ìˆ˜ë™ ë‹¤ìš´ë¡œë“œë¡œ ì‹œì‘

**Phase 2 êµ¬í˜„ ê³„íš**:
- electron-updater ì—°ë™
- GitHub Releases ìë™ ë°°í¬
- ì—…ë°ì´íŠ¸ ì•Œë¦¼ UI

---

## êµ¬ë… ëª¨ë¸ ë³€ê²½

### ê¸°ì¡´ ì„¤ê³„ (Phase 2)
```
ì‚¬ìš©ì â†’ Stripe Checkout â†’ ìë™ ê²°ì œ â†’ DB ì—…ë°ì´íŠ¸
```

### MVP ì„¤ê³„
```
ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ â†’ ìˆ˜ë™ ë“±ê¸‰ ë¶€ì—¬ â†’ DB ì—…ë°ì´íŠ¸ â†’ í´ë¼ì´ì–¸íŠ¸ ë™ê¸°í™”
```

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¡°ì •

#### subscriptions í…Œì´ë¸” (MVP ë²„ì „)
```sql
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE UNIQUE,
  tier TEXT CHECK (tier IN ('free', 'basic', 'pro')) NOT NULL DEFAULT 'free',
  status TEXT CHECK (status IN ('free', 'active', 'expired', 'suspended')) NOT NULL DEFAULT 'free',

  -- MVP: Stripe ê´€ë ¨ ì»¬ëŸ¼ì€ NULL í—ˆìš©
  stripe_customer_id TEXT,
  stripe_subscription_id TEXT,

  -- MVP: ê´€ë¦¬ì ì„ ë¬¼ ê¸°ëŠ¥ â­
  granted_by UUID REFERENCES auth.users(id),  -- ê´€ë¦¬ì ID
  payment_method TEXT CHECK (payment_method IN ('admin_grant', 'stripe')) DEFAULT 'admin_grant',
  grant_reason TEXT,  -- "ë² íƒ€ í…ŒìŠ¤í„°", "ì´ë²¤íŠ¸ ë‹¹ì²¨" ë“±

  expires_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_subscriptions_user_id ON subscriptions(user_id);
CREATE INDEX idx_subscriptions_granted_by ON subscriptions(granted_by);
CREATE INDEX idx_subscriptions_expires_at ON subscriptions(expires_at);
```

### Edge Function ì¡°ì •

#### MVPì—ì„œ í•„ìš”í•œ Edge Functions

1. **check-subscription** (ìœ ì§€)
   - êµ¬ë… ìƒíƒœ í™•ì¸
   - ë§Œë£Œ ì²´í¬
   - Free ë‹¤ìš´ê·¸ë ˆì´ë“œ

2. **login-with-device-check** (ìœ ì§€)
   - ê¸°ê¸° ì¸ì¦
   - ê¸°ê¸° ë“±ë¡ ìˆ˜ í™•ì¸

3. **register-device** (ìœ ì§€)
   - ìƒˆ ê¸°ê¸° ë“±ë¡

4. **admin-grant-subscription** (ì‹ ê·œ â­)
   - ê´€ë¦¬ìê°€ ì‚¬ìš©ìì—ê²Œ ë“±ê¸‰ ë¶€ì—¬

#### MVPì—ì„œ ì œì™¸í•˜ëŠ” Edge Functions

- ~~create-checkout-session~~ (Phase 2)
- ~~webhook-stripe~~ (Phase 2)
- ~~cancel-subscription~~ (Phase 2)
- ~~track-referral~~ (Phase 2)
- ~~process-commission~~ (Phase 2)

---

## êµ¬ë… ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜

### ì˜¤í”„ë¼ì¸ ìºì‹œ (5ì¼)

ì‚¬ìš©ìê°€ ì¸í„°ë„· ì—°ê²° ì—†ì´ ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬ë… ì •ë³´ë¥¼ ë¡œì»¬ì— ìºì‹œí•©ë‹ˆë‹¤.

#### ê²€ì¦ ë¡œì§

```typescript
// client/services/SubscriptionManager.ts

class SubscriptionManager {
  private cache: SubscriptionInfo | null = null;
  private lastCheck: Date | null = null;
  private readonly ONLINE_CACHE_DURATION = 3600000;  // 1ì‹œê°„ (ì˜¨ë¼ì¸)
  private readonly OFFLINE_GRACE_PERIOD = 432000000; // 5ì¼ (ì˜¤í”„ë¼ì¸)

  /**
   * êµ¬ë… í™•ì¸ (ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ëŒ€ì‘)
   */
  async checkSubscription(forceRefresh = false): Promise<SubscriptionInfo> {
    // 1. ì˜¨ë¼ì¸ ìƒíƒœ í™•ì¸
    const isOnline = navigator.onLine;

    // 2. ìºì‹œ ìœ íš¨ì„± ê²€ì¦
    if (!forceRefresh && this.cache && this.lastCheck) {
      const timeSinceCheck = Date.now() - this.lastCheck.getTime();

      if (isOnline) {
        // ì˜¨ë¼ì¸: 1ì‹œê°„ ìºì‹œ
        if (timeSinceCheck < this.ONLINE_CACHE_DURATION) {
          return this.cache;
        }
      } else {
        // ì˜¤í”„ë¼ì¸: 5ì¼ grace period
        if (timeSinceCheck < this.OFFLINE_GRACE_PERIOD) {
          return this.cache;
        } else {
          // 5ì¼ ì´ˆê³¼: Freeë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œ â­
          return this.downgradeToFree('offline_grace_period_exceeded');
        }
      }
    }

    // 3. ì„œë²„ì—ì„œ ìµœì‹  ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì˜¨ë¼ì¸ë§Œ)
    if (isOnline) {
      try {
        const info = await this.fetchFromServer();

        // ë§Œë£Œ ì²´í¬
        if (info.expires_at && new Date(info.expires_at) < new Date()) {
          info.status = 'expired';
          await this.downgradeToFreeOnServer(info.user_id);
        }

        // ìºì‹œ ì—…ë°ì´íŠ¸
        this.cache = info;
        this.lastCheck = new Date();

        return info;
      } catch (error) {
        // ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ê¸°ì¡´ ìºì‹œ ì‚¬ìš©
        if (this.cache) {
          console.warn('[SubscriptionManager] Server unreachable, using cache');
          return this.cache;
        }
        throw error;
      }
    } else {
      // ì˜¤í”„ë¼ì¸ì´ê³  ìºì‹œë„ ì—†ìŒ: Freeë¡œ ì‹œì‘
      if (!this.cache) {
        return this.getFreeSubscription();
      }
      return this.cache;
    }
  }

  /**
   * Free ë“±ê¸‰ìœ¼ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œ (ë¡œì»¬)
   */
  private downgradeToFree(reason: string): SubscriptionInfo {
    console.warn(`[SubscriptionManager] Downgrading to Free: ${reason}`);

    const freeInfo: SubscriptionInfo = this.getFreeSubscription();

    // ìºì‹œ ì—…ë°ì´íŠ¸
    this.cache = freeInfo;
    this.lastCheck = new Date();

    // UI ì•Œë¦¼
    this.notifyDowngrade(reason);

    return freeInfo;
  }

  /**
   * Free ë“±ê¸‰ìœ¼ë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œ (ì„œë²„)
   */
  private async downgradeToFreeOnServer(userId: string): Promise<void> {
    await supabase
      .from('subscriptions')
      .update({
        tier: 'free',
        status: 'expired',
        updated_at: new Date()
      })
      .eq('user_id', userId);

    // ì´ë²¤íŠ¸ ë¡œê¹…
    await this.logEvent('subscription_downgraded', {
      reason: 'expired',
      previous_tier: this.cache?.tier
    });
  }

  /**
   * Free êµ¬ë… ì •ë³´ ìƒì„±
   */
  private getFreeSubscription(): SubscriptionInfo {
    return {
      tier: 'free',
      status: 'free',
      features: {
        formats: ['webp'],
        scopes: ['file'],
        backup: false,
        log: false,
        max_batch_size: 10
      },
      device_limit: 2,
      device_count: 0,
      expires_at: null
    };
  }

  /**
   * ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼
   */
  private notifyDowngrade(reason: string): void {
    let message: string;

    if (reason === 'offline_grace_period_exceeded') {
      message = '5ì¼ ì´ìƒ ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤.\n' +
                'Free ë“±ê¸‰ìœ¼ë¡œ ì œí•œë©ë‹ˆë‹¤.\n' +
                'ì¸í„°ë„· ì—°ê²° í›„ ì•±ì„ ì¬ì‹œì‘í•´ì£¼ì„¸ìš”.';
    } else if (reason === 'expired') {
      message = 'êµ¬ë…ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n' +
                'Free ë“±ê¸‰ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.\n' +
                'ê³„ì† ì‚¬ìš©í•˜ì‹œë ¤ë©´ ì—…ê·¸ë ˆì´ë“œí•´ì£¼ì„¸ìš”.';
    } else {
      message = 'Free ë“±ê¸‰ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.';
    }

    // Electron dialog
    dialog.showMessageBox({
      type: 'warning',
      title: 'êµ¬ë… ìƒíƒœ ë³€ê²½',
      message,
      buttons: ['í™•ì¸']
    });

    // ì´ë²¤íŠ¸ ë°œí–‰
    emitEvent('subscription:downgraded', { reason });
  }

  /**
   * ìºì‹œ ë¬´íš¨í™”
   */
  invalidateCache(): void {
    this.cache = null;
    this.lastCheck = null;
  }
}

export const subscriptionManager = new SubscriptionManager();
```

### ì•± ì‹œì‘ ì‹œ ê²€ì¦ í”Œë¡œìš°

```typescript
// client/main/index.ts

async function initializeApp() {
  // 1. ì‚¬ìš©ì ì¸ì¦ í™•ì¸
  const { data: { session } } = await supabase.auth.getSession();

  if (!session) {
    // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    mainWindow.loadURL('/#/login');
    return;
  }

  // 2. êµ¬ë… ìƒíƒœ í™•ì¸ â­
  try {
    const subscription = await subscriptionManager.checkSubscription();

    console.log('[App] Subscription:', subscription.tier, subscription.status);

    // 3. ë§Œë£Œ ë˜ëŠ” 5ì¼ ì´ˆê³¼ ì‹œ ì•Œë¦¼
    if (subscription.status === 'expired') {
      // UIì—ì„œ ì—…ê·¸ë ˆì´ë“œ ìœ ë„
    }

    // 4. ë©”ì¸ í™”ë©´ ë¡œë“œ
    mainWindow.loadURL('/#/main');
  } catch (error) {
    console.error('[App] Failed to check subscription:', error);

    // ì˜¤ë¥˜ ì‹œ Free ë“±ê¸‰ìœ¼ë¡œ ì‹œì‘
    mainWindow.loadURL('/#/main');
  }
}
```

---

## ì—…ì…€ë§ ì „ëµ

### 1. ê¸°ëŠ¥ ì ê¸ˆ UI

Pro ê¸°ëŠ¥ì„ UIì— í‘œì‹œí•˜ë˜ ë¹„í™œì„±í™”í•˜ê³ , í´ë¦­ ì‹œ ì—…ê·¸ë ˆì´ë“œ ìœ ë„ íŒì—…ì„ ë„ì›ë‹ˆë‹¤.

#### UI ë””ìì¸

```typescript
// client/components/FormatSelector.tsx

export function FormatSelector() {
  const subscription = useSubscription();

  const formats = [
    { id: 'webp', name: 'WebP', tier: 'free' },
    { id: 'avif', name: 'AVIF', tier: 'basic', description: '20% ë” ì••ì¶•' },
    { id: 'jxl', name: 'JPEG XL', tier: 'pro', description: 'ìµœê³  í’ˆì§ˆ' }
  ];

  return (
    <div className="format-selector">
      {formats.map(format => {
        const isLocked = !canUseFormat(subscription.tier, format.tier);

        return (
          <button
            key={format.id}
            className={`format-button ${isLocked ? 'locked' : ''}`}
            onClick={() => isLocked ? showUpgradeDialog(format) : selectFormat(format.id)}
            disabled={isLocked}
          >
            <div className="format-icon">
              {isLocked && <LockIcon />}
              <img src={`/icons/${format.id}.svg`} alt={format.name} />
            </div>
            <div className="format-info">
              <h3>{format.name}</h3>
              {format.description && (
                <p className="format-description">{format.description}</p>
              )}
              {isLocked && (
                <span className="tier-badge">{format.tier.toUpperCase()}</span>
              )}
            </div>
          </button>
        );
      })}
    </div>
  );
}

function canUseFormat(userTier: string, requiredTier: string): boolean {
  const tierOrder = { free: 0, basic: 1, pro: 2 };
  return tierOrder[userTier] >= tierOrder[requiredTier];
}
```

#### ì—…ê·¸ë ˆì´ë“œ ë‹¤ì´ì–¼ë¡œê·¸ (MVP ë²„ì „)

```typescript
// client/components/UpgradeDialog.tsx

export function UpgradeDialog({ format }: { format: Format }) {
  return (
    <Dialog open={true} onClose={onClose}>
      <DialogTitle>
        <LockIcon /> {format.name}ëŠ” {format.tier.toUpperCase()} ë“±ê¸‰ ê¸°ëŠ¥ì…ë‹ˆë‹¤
      </DialogTitle>

      <DialogContent>
        <div className="feature-highlight">
          <img src={`/icons/${format.id}.svg`} alt={format.name} />
          <h3>{format.name} ë³€í™˜</h3>
          <p>{format.description}</p>
        </div>

        <div className="tier-comparison">
          <TierCard tier="free" currentTier={subscription.tier} />
          <TierCard tier={format.tier} currentTier={subscription.tier} highlight />
        </div>

        {/* MVP: ê³§ ì¶œì‹œ ì˜ˆì • ë©”ì‹œì§€ â­ */}
        <Alert severity="info">
          <AlertTitle>ê³§ ì¶œì‹œ ì˜ˆì •!</AlertTitle>
          ìœ ë£Œ ê²°ì œ ê¸°ëŠ¥ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.
          ë² íƒ€ í…ŒìŠ¤í„°ì—ê²ŒëŠ” ë¬´ë£Œë¡œ ì œê³µë  ì˜ˆì •ì´ë‹ˆ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! ğŸ‰
        </Alert>

        {/* Phase 2: ì‹¤ì œ ê²°ì œ ë²„íŠ¼
        <Button
          variant="contained"
          color="primary"
          onClick={handleUpgrade}
        >
          ì§€ê¸ˆ ì—…ê·¸ë ˆì´ë“œ (â‚©9,900/ì›”)
        </Button>
        */}
      </DialogContent>

      <DialogActions>
        <Button onClick={onClose}>ë‚˜ì¤‘ì—</Button>
        <Button onClick={handleWaitlist} variant="outlined">
          ì•Œë¦¼ ì‹ ì²­í•˜ê¸°
        </Button>
      </DialogActions>
    </Dialog>
  );
}
```

### 2. ë³€í™˜ ì™„ë£Œ ë©”ì‹œì§€

Free ì‚¬ìš©ìê°€ ë³€í™˜ì„ ì™„ë£Œí–ˆì„ ë•Œ Pro ê¸°ëŠ¥ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

```typescript
// client/services/ImageProcessor.ts

async function onConversionComplete(result: ConversionResult) {
  // ê¸°ë³¸ ì™„ë£Œ ì•Œë¦¼
  toast.success(`${result.fileCount}ê°œ íŒŒì¼ ë³€í™˜ ì™„ë£Œ!`);

  // Free ì‚¬ìš©ìì—ê²Œ ì—…ì…€ë§ ë©”ì‹œì§€ í‘œì‹œ â­
  if (subscription.tier === 'free') {
    setTimeout(() => {
      showUpsellMessage(result);
    }, 1000);
  }

  // ì´ë²¤íŠ¸ ë°œí–‰
  emitEvent('conversion:completed', result);
}

function showUpsellMessage(result: ConversionResult) {
  // MVP: "ê³§ ì¶œì‹œ" ë©”ì‹œì§€
  toast.info(
    <div className="upsell-toast">
      <div className="upsell-content">
        <h4>ë” ì‘ì€ íŒŒì¼ í¬ê¸°ë¥¼ ì›í•˜ì‹œë‚˜ìš”?</h4>
        <p>Pro ë“±ê¸‰ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ê³  AVIFë¡œ 20% ë” ì••ì¶•í•´ ë³´ì„¸ìš”!</p>
        <small>ğŸ’¡ ê³§ ì¶œì‹œ ì˜ˆì • - ë² íƒ€ í…ŒìŠ¤í„°ì—ê²Œ ë¬´ë£Œ ì œê³µ</small>
      </div>
      <button onClick={handleUpgradeClick}>
        ìì„¸íˆ ë³´ê¸°
      </button>
    </div>,
    { duration: 8000, position: 'bottom-right' }
  );
}
```

### 3. ì„¤ì • í™”ë©´ ì—…ì…€ë§

```typescript
// client/pages/SettingsPage.tsx

export function SettingsPage() {
  const subscription = useSubscription();

  return (
    <div className="settings-page">
      {/* í˜„ì¬ ë“±ê¸‰ í‘œì‹œ */}
      <CurrentTierSection subscription={subscription} />

      {/* Free ì‚¬ìš©ìì—ê²Œ ì—…ê·¸ë ˆì´ë“œ ë°°ë„ˆ í‘œì‹œ */}
      {subscription.tier === 'free' && (
        <UpgradeBanner>
          <h3>ë” ë§ì€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”</h3>
          <ul>
            <li>âœ… AVIF í¬ë§· (20% ë” ì••ì¶•)</li>
            <li>âœ… í´ë” ì „ì²´ ë³€í™˜</li>
            <li>âœ… ì›ë³¸ íŒŒì¼ ìë™ ë°±ì—…</li>
            <li>âœ… Excel ì‘ì—… ë¡œê·¸</li>
            <li>âœ… ìµœëŒ€ 15ê°œ ë°°ì¹˜ ì²˜ë¦¬ (Basic) / ë¬´ì œí•œ (Pro)</li>
          </ul>
          <Button onClick={showUpgradeDialog}>
            ì—…ê·¸ë ˆì´ë“œ (ì¤€ë¹„ ì¤‘)
          </Button>
        </UpgradeBanner>
      )}

      {/* ë‚˜ë¨¸ì§€ ì„¤ì • í•­ëª© */}
      <GeneralSettings />
      <AdvancedSettings />
    </div>
  );
}
```

---

## ê´€ë¦¬ì ì„ ë¬¼ ê¸°ëŠ¥

### 1. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ë“±ê¸‰ ë¶€ì—¬

```typescript
// admin/pages/UserManagement.tsx

export function UserManagement() {
  const [users, setUsers] = useState<User[]>([]);
  const [selectedUser, setSelectedUser] = useState<User | null>(null);

  async function handleGrantSubscription(
    userId: string,
    tier: 'basic' | 'pro',
    duration: number,  // ì¼ ìˆ˜
    reason: string
  ) {
    const expiresAt = new Date();
    expiresAt.setDate(expiresAt.getDate() + duration);

    const { data: admin } = await supabase.auth.getUser();

    // Edge Function í˜¸ì¶œ
    const { error } = await supabase.functions.invoke('admin-grant-subscription', {
      body: {
        user_id: userId,
        tier,
        expires_at: expiresAt.toISOString(),
        granted_by: admin.user.id,
        payment_method: 'admin_grant',
        grant_reason: reason
      }
    });

    if (error) {
      toast.error(`ë“±ê¸‰ ë¶€ì—¬ ì‹¤íŒ¨: ${error.message}`);
      return;
    }

    toast.success(`${tier.toUpperCase()} ë“±ê¸‰ì´ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);

    // ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    await loadUsers();
  }

  return (
    <div className="user-management">
      <DataTable
        columns={[
          { field: 'email', headerName: 'ì´ë©”ì¼' },
          { field: 'tier', headerName: 'ë“±ê¸‰', renderCell: (row) => (
            <TierBadge tier={row.tier} grantedBy={row.granted_by} />
          )},
          { field: 'status', headerName: 'ìƒíƒœ' },
          { field: 'expires_at', headerName: 'ë§Œë£Œì¼' },
          { field: 'actions', headerName: 'ì‘ì—…', renderCell: (row) => (
            <Button onClick={() => openGrantDialog(row)}>
              ë“±ê¸‰ ë³€ê²½
            </Button>
          )}
        ]}
        rows={users}
      />

      {/* ë“±ê¸‰ ë¶€ì—¬ ë‹¤ì´ì–¼ë¡œê·¸ */}
      {selectedUser && (
        <GrantSubscriptionDialog
          user={selectedUser}
          onGrant={handleGrantSubscription}
          onClose={() => setSelectedUser(null)}
        />
      )}
    </div>
  );
}
```

### 2. ë“±ê¸‰ ë¶€ì—¬ ë‹¤ì´ì–¼ë¡œê·¸

```typescript
// admin/components/GrantSubscriptionDialog.tsx

export function GrantSubscriptionDialog({ user, onGrant, onClose }) {
  const [tier, setTier] = useState<'basic' | 'pro'>('basic');
  const [duration, setDuration] = useState(30);  // ê¸°ë³¸ 30ì¼
  const [reason, setReason] = useState('');

  const presetReasons = [
    'ë² íƒ€ í…ŒìŠ¤í„°',
    'ì´ë²¤íŠ¸ ë‹¹ì²¨',
    'í”¼ë“œë°± ì œê³µ',
    'ë²„ê·¸ ë¦¬í¬íŠ¸',
    'í”„ë¡œëª¨ì…˜',
    'ê¸°íƒ€'
  ];

  return (
    <Dialog open={true} onClose={onClose}>
      <DialogTitle>
        ë“±ê¸‰ ë¶€ì—¬ - {user.email}
      </DialogTitle>

      <DialogContent>
        {/* ë“±ê¸‰ ì„ íƒ */}
        <FormControl fullWidth>
          <InputLabel>ë“±ê¸‰</InputLabel>
          <Select value={tier} onChange={(e) => setTier(e.target.value)}>
            <MenuItem value="basic">
              <div className="tier-option">
                <span>Basic</span>
                <small>AVIF ë³€í™˜, í´ë” ì²˜ë¦¬, ë°±ì—…/ë¡œê·¸</small>
              </div>
            </MenuItem>
            <MenuItem value="pro">
              <div className="tier-option">
                <span>Pro</span>
                <small>ëª¨ë“  í¬ë§·, í´ë” ì²˜ë¦¬, ë°±ì—…/ë¡œê·¸, í†µê³„</small>
              </div>
            </MenuItem>
          </Select>
        </FormControl>

        {/* ê¸°ê°„ ì„ íƒ */}
        <FormControl fullWidth>
          <InputLabel>ê¸°ê°„</InputLabel>
          <Select value={duration} onChange={(e) => setDuration(e.target.value)}>
            <MenuItem value={7}>7ì¼</MenuItem>
            <MenuItem value={30}>30ì¼ (1ê°œì›”)</MenuItem>
            <MenuItem value={90}>90ì¼ (3ê°œì›”)</MenuItem>
            <MenuItem value={180}>180ì¼ (6ê°œì›”)</MenuItem>
            <MenuItem value={365}>365ì¼ (1ë…„)</MenuItem>
            <MenuItem value={9999}>ë¬´ì œí•œ</MenuItem>
          </Select>
        </FormControl>

        {/* ì‚¬ìœ  ì„ íƒ */}
        <FormControl fullWidth>
          <InputLabel>ì‚¬ìœ </InputLabel>
          <Select value={reason} onChange={(e) => setReason(e.target.value)}>
            {presetReasons.map(r => (
              <MenuItem key={r} value={r}>{r}</MenuItem>
            ))}
          </Select>
        </FormControl>

        {reason === 'ê¸°íƒ€' && (
          <TextField
            fullWidth
            label="ì‚¬ìœ  ì…ë ¥"
            value={customReason}
            onChange={(e) => setCustomReason(e.target.value)}
          />
        )}

        {/* ë¯¸ë¦¬ë³´ê¸° */}
        <Alert severity="info">
          <strong>{user.email}</strong>ë‹˜ì—ê²Œ
          <strong> {tier.toUpperCase()} ë“±ê¸‰</strong>ì„
          <strong> {duration === 9999 ? 'ë¬´ì œí•œ' : `${duration}ì¼`}</strong> ë™ì•ˆ ë¶€ì—¬í•©ë‹ˆë‹¤.
          <br />
          <small>ì‚¬ìœ : {reason}</small>
        </Alert>
      </DialogContent>

      <DialogActions>
        <Button onClick={onClose}>ì·¨ì†Œ</Button>
        <Button
          variant="contained"
          color="primary"
          onClick={() => onGrant(user.id, tier, duration, reason)}
        >
          ë“±ê¸‰ ë¶€ì—¬
        </Button>
      </DialogActions>
    </Dialog>
  );
}
```

### 3. í´ë¼ì´ì–¸íŠ¸ - "ë”ì¹´ë‹¹ì˜ ì„ ë¬¼" í‘œì‹œ

```typescript
// client/components/SubscriptionBadge.tsx

export function SubscriptionBadge({ subscription }: { subscription: SubscriptionInfo }) {
  const isGift = subscription.payment_method === 'admin_grant';

  return (
    <div className={`subscription-badge tier-${subscription.tier}`}>
      {isGift ? (
        <>
          <div className="gift-header">
            <GiftIcon />
            <span className="gift-text">ë”ì¹´ë‹¹ì˜ ì„ ë¬¼!</span>
          </div>
          <div className="tier-name">
            {subscription.tier.toUpperCase()} ë“±ê¸‰ì…ë‹ˆë‹¤
          </div>
          {subscription.grant_reason && (
            <div className="grant-reason">
              {subscription.grant_reason}
            </div>
          )}
        </>
      ) : (
        <div className="tier-name">
          {subscription.tier.toUpperCase()} ë“±ê¸‰
        </div>
      )}

      {subscription.expires_at && (
        <div className="expires-at">
          ë§Œë£Œ: {formatDate(subscription.expires_at)}
        </div>
      )}
    </div>
  );
}
```

```css
/* client/styles/subscription-badge.css */

.subscription-badge {
  padding: 16px;
  border-radius: 12px;
  border: 2px solid;
  background: linear-gradient(135deg, var(--tier-color-light), var(--tier-color-dark));
}

.subscription-badge.tier-free {
  --tier-color-light: #e3f2fd;
  --tier-color-dark: #90caf9;
  border-color: #42a5f5;
}

.subscription-badge.tier-basic {
  --tier-color-light: #f3e5f5;
  --tier-color-dark: #ce93d8;
  border-color: #ab47bc;
}

.subscription-badge.tier-pro {
  --tier-color-light: #fff3e0;
  --tier-color-dark: #ffb74d;
  border-color: #ff9800;
}

.gift-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  animation: sparkle 2s infinite;
}

.gift-text {
  font-weight: 600;
  font-size: 14px;
  color: #ff6b6b;
}

.tier-name {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
}

.grant-reason {
  font-size: 12px;
  color: #666;
  margin-top: 4px;
}

.expires-at {
  font-size: 12px;
  color: #999;
  margin-top: 8px;
}

@keyframes sparkle {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
```

### 4. Edge Function: admin-grant-subscription

```typescript
// server/supabase/functions/admin-grant-subscription/index.ts

import { createClient } from '@supabase/supabase-js';

Deno.serve(async (req) => {
  const supabaseAdmin = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  // 1. ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  const authHeader = req.headers.get('Authorization')!;
  const { data: { user }, error: authError } = await supabaseAdmin.auth.getUser(
    authHeader.replace('Bearer ', '')
  );

  if (authError || !user) {
    return new Response(
      JSON.stringify({ error: 'Unauthorized' }),
      { status: 401, headers: { 'Content-Type': 'application/json' } }
    );
  }

  // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (auth.users í…Œì´ë¸”ì˜ user_metadata ë˜ëŠ” ë³„ë„ í…Œì´ë¸”)
  const { data: profile } = await supabaseAdmin
    .from('user_profiles')
    .select('role')
    .eq('user_id', user.id)
    .single();

  if (profile?.role !== 'admin') {
    return new Response(
      JSON.stringify({ error: 'Forbidden' }),
      { status: 403, headers: { 'Content-Type': 'application/json' } }
    );
  }

  // 2. ìš”ì²­ íŒŒë¼ë¯¸í„° ì¶”ì¶œ
  const {
    user_id,
    tier,
    expires_at,
    granted_by,
    payment_method,
    grant_reason
  } = await req.json();

  // 3. êµ¬ë… ì—…ë°ì´íŠ¸
  const { error: upsertError } = await supabaseAdmin
    .from('subscriptions')
    .upsert({
      user_id,
      tier,
      status: 'active',
      expires_at,
      granted_by,
      payment_method,
      grant_reason,
      updated_at: new Date()
    }, {
      onConflict: 'user_id'
    });

  if (upsertError) {
    return new Response(
      JSON.stringify({ error: upsertError.message }),
      { status: 500, headers: { 'Content-Type': 'application/json' } }
    );
  }

  // 4. ì´ë²¤íŠ¸ ë¡œê¹…
  await supabaseAdmin
    .from('user_events')
    .insert({
      user_id,
      event_type: 'subscription_granted',
      event_data: {
        tier,
        expires_at,
        granted_by,
        grant_reason
      }
    });

  // 5. ì„±ê³µ ì‘ë‹µ
  return new Response(
    JSON.stringify({
      success: true,
      data: {
        user_id,
        tier,
        expires_at
      }
    }),
    { status: 200, headers: { 'Content-Type': 'application/json' } }
  );
});
```

---

## ê°œë°œ ìš°ì„ ìˆœìœ„

### Sprint 1 (Week 1-2): í•µì‹¬ ê¸°ëŠ¥
- [x] Supabase í”„ë¡œì íŠ¸ ìƒì„± ë° ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜
- [x] ì‚¬ìš©ì ì¸ì¦ (íšŒì›ê°€ì…, ë¡œê·¸ì¸, ì´ë©”ì¼ ì¸ì¦)
- [x] ê¸°ê¸° ì¸ì¦ ì‹œìŠ¤í…œ
- [x] WebP ë³€í™˜ ê¸°ëŠ¥ (Sharp)
- [x] êµ¬ë… ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜ (ì˜¤í”„ë¼ì¸ 5ì¼)

### Sprint 2 (Week 3-4): ë“±ê¸‰ë³„ ê¸°ëŠ¥
- [x] AVIF ë³€í™˜ ê¸°ëŠ¥
- [x] í´ë” ë‹¨ìœ„ ì²˜ë¦¬
- [x] ë°±ì—… ì‹œìŠ¤í…œ (BackupManager)
- [x] ë¡œê·¸ ì‹œìŠ¤í…œ (LogManager + ExcelJS)
- [x] ë“±ê¸‰ë³„ ê¸°ëŠ¥ ì œí•œ (Strategy Pattern)

### Sprint 3 (Week 5-6): ì—…ì…€ë§ ë° ê´€ë¦¬ì
- [x] ì—…ì…€ë§ UI (ê¸°ëŠ¥ ì ê¸ˆ, ë³€í™˜ ì™„ë£Œ ë©”ì‹œì§€)
- [x] ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
- [x] ê´€ë¦¬ì ì„ ë¬¼ ê¸°ëŠ¥ (admin-grant-subscription)
- [x] "ë”ì¹´ë‹¹ì˜ ì„ ë¬¼" UI

### Sprint 4 (Week 7-8): ë§ˆë¬´ë¦¬
- [ ] ë‹¤êµ­ì–´ ì§€ì› (i18next)
- [ ] íŒ¨í‚¤ì§• ë° ë¹Œë“œ (electron-builder)
- [ ] ë² íƒ€ í…ŒìŠ¤íŠ¸
- [ ] ë²„ê·¸ ìˆ˜ì • ë° ìµœì í™”

---

## êµ¬í˜„ ê°€ì´ë“œ

### Phase 2 ëŒ€ë¹„ ì¤€ë¹„

MVPì—ì„œ ì œì™¸í•œ ê¸°ëŠ¥ë“¤ì„ Phase 2ì—ì„œ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„í•©ë‹ˆë‹¤.

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¤€ë¹„

```sql
-- MVP: payment_methodë¥¼ 'admin_grant'ë¡œ ê¸°ë³¸ ì„¤ì •
-- Phase 2: 'stripe'ë¡œ ì „í™˜

ALTER TABLE subscriptions
ALTER COLUMN payment_method SET DEFAULT 'admin_grant';

-- Phase 2 ë§ˆì´ê·¸ë ˆì´ì…˜
-- ALTER TABLE subscriptions
-- ALTER COLUMN payment_method SET DEFAULT 'stripe';
```

#### 2. Edge Functions ì¤€ë¹„

```typescript
// MVP: Edge Functions ë””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ë¯¸ë¦¬ ìƒì„±
server/supabase/functions/
â”œâ”€â”€ admin-grant-subscription/       # MVPì—ì„œ ì‚¬ìš© âœ…
â”œâ”€â”€ check-subscription/             # MVPì—ì„œ ì‚¬ìš© âœ…
â”œâ”€â”€ login-with-device-check/        # MVPì—ì„œ ì‚¬ìš© âœ…
â”œâ”€â”€ register-device/                # MVPì—ì„œ ì‚¬ìš© âœ…
â”œâ”€â”€ create-checkout-session/        # Phase 2ì—ì„œ êµ¬í˜„ ğŸ”œ
â”œâ”€â”€ webhook-stripe/                 # Phase 2ì—ì„œ êµ¬í˜„ ğŸ”œ
â”œâ”€â”€ cancel-subscription/            # Phase 2ì—ì„œ êµ¬í˜„ ğŸ”œ
â”œâ”€â”€ track-referral/                 # Phase 2ì—ì„œ êµ¬í˜„ ğŸ”œ
â””â”€â”€ process-commission/             # Phase 2ì—ì„œ êµ¬í˜„ ğŸ”œ
```

#### 3. UI ì¤€ë¹„

```typescript
// client/components/UpgradeDialog.tsx

// MVP
const MVP_MODE = true;

{MVP_MODE ? (
  <Alert severity="info">
    ê³§ ì¶œì‹œ ì˜ˆì •! ë² íƒ€ í…ŒìŠ¤í„°ì—ê²Œ ë¬´ë£Œ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.
  </Alert>
) : (
  <Button onClick={handleStripeCheckout}>
    ì§€ê¸ˆ ì—…ê·¸ë ˆì´ë“œ (â‚©9,900/ì›”)
  </Button>
)}
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### MVP ì™„ë£Œ ê¸°ì¤€

#### í•µì‹¬ ê¸°ëŠ¥
- [ ] WebP ë³€í™˜ (Free)
- [ ] AVIF ë³€í™˜ (Basic ì´ìƒ)
- [ ] í´ë” ì²˜ë¦¬ (Basic ì´ìƒ)
- [ ] ë°±ì—… ì‹œìŠ¤í…œ (Basic ì´ìƒ)
- [ ] ë¡œê·¸ ì‹œìŠ¤í…œ (Basic ì´ìƒ)

#### êµ¬ë… ì‹œìŠ¤í…œ
- [ ] êµ¬ë… ê²€ì¦ (ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸)
- [ ] 5ì¼ grace period
- [ ] ë§Œë£Œ ì‹œ Free ë‹¤ìš´ê·¸ë ˆì´ë“œ
- [ ] ê´€ë¦¬ì ì„ ë¬¼ ê¸°ëŠ¥

#### ì—…ì…€ë§
- [ ] ê¸°ëŠ¥ ì ê¸ˆ UI
- [ ] ì—…ê·¸ë ˆì´ë“œ ë‹¤ì´ì–¼ë¡œê·¸ (ê³§ ì¶œì‹œ ë©”ì‹œì§€)
- [ ] ë³€í™˜ ì™„ë£Œ ì—…ì…€ë§ ë©”ì‹œì§€

#### ê´€ë¦¬ì
- [ ] ì‚¬ìš©ì ëª©ë¡ ë° ê²€ìƒ‰
- [ ] ë“±ê¸‰ ìˆ˜ë™ ë¶€ì—¬
- [ ] "ë”ì¹´ë‹¹ì˜ ì„ ë¬¼" í‘œì‹œ

#### ê¸°íƒ€
- [ ] í•œêµ­ì–´/ì˜ì–´ ë‹¤êµ­ì–´
- [ ] Windows/macOS ë¹Œë“œ
- [ ] ë² íƒ€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

**ë‹¤ìŒ ë¬¸ì„œ**:
- [database-schema.md](../architecture/database-schema.md) - MVP ìŠ¤í‚¤ë§ˆ
- [subscription-service.md](../architecture/subscription-service.md) - êµ¬ë… ë¡œì§
- [extensibility-guide.md](../architecture/extensibility-guide.md) - Phase 2 í™•ì¥ ì¤€ë¹„

**Phase 2 ì¶”ê°€ ì˜ˆì •**:
- Stripe ê²°ì œ ì—°ë™
- ì–´í•„ë¦¬ì—ì´íŠ¸ ì‹œìŠ¤í…œ
- ìë™ ì—…ë°ì´íŠ¸
- ê³ ê¸‰ ë¶„ì„ ê¸°ëŠ¥
